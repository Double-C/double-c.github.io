<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><title>Laravel 项目开发规范 | 而废不能半途</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="[object Object]"><meta name="designer" content="minfive"><meta name="keywords" content="double-c, chao, 后端, 程序员, laravel, php"><meta name="description" content="总不能还没有努力就向生活妥协。"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="https://double-c.github.io/2018/09/25/laravel-specification/index.html"><link rel="icon" type="image/png" href="/img/favicon.ico" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="Double-c"><link rel="stylesheet" href="/scss/views/page/post.css"></head><body ontouchstart><div id="page-loading" class="page page-loading" style="background-image:url(/img/loader.gif)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="Double-c" alt="Double-c"><img src="/img/chao-logo-white.png" alt="Double-c"></a><nav class="page__nav"><ul class="nav__list clearfix"><li class="nav__item"><a href="/" alt="首页" title="首页">首页</a></li><li class="nav__item"><a href="/archives" alt="归档" title="归档">归档</a></li><li class="nav__item"><a href="/about" alt="关于" title="关于">关于</a></li></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><div class="post__cover"><img src="/img/posts/laravel.png" alt="Laravel 项目开发规范"></div><header class="post__info"><h1 class="post__title">Laravel 项目开发规范</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="https://github.com/summerblue">Summer</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2018-09-25</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/php/">Php</a></li><li class="mark__item"><a href="/tags/laravel/">Laravel</a></li></ul></div></div></header><div class="post__content"><h2 id="Laravel-项目开发规范"><a href="#Laravel-项目开发规范" class="headerlink" title="Laravel 项目开发规范"></a>Laravel 项目开发规范</h2><h4 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h4><ul><li><a href="#优势">优势</a></li><li><a href="#开发哲学">开发哲学</a></li><li><a href="#设计理念">设计理念</a></li><li><a href="#开发和线上环境">开发和线上环境</a></li><li><a href="#开发专用扩展包">开发专用扩展包</a></li><li><a href="#辅助函数">辅助函数</a></li><li><a href="#路由">路由</a></li><li><a href="#数据模型">数据模型</a></li><li><a href="#控制器">控制器</a></li><li><a href="#视图">视图</a></li><li><a href="#表单验证">表单验证</a></li><li><a href="#授权策略">授权策略</a></li><li><a href="#Auth 中间件">Auth 中间件</a></li></ul><h4 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h4><p>规范有以下优点：</p><ul><li><strong>高效编码</strong>：避免了过多的选择造成的『决策时间』浪费</li><li><strong>风格统一</strong> ： 最大程度统一了开发团队成员代码书写风格和思路，代码阅读起来如出一辙</li><li><strong>减少错误</strong> ： 减小初级工程师的犯错几率。</li></ul><h4 id="开发哲学"><a href="#开发哲学" class="headerlink" title="开发哲学"></a>开发哲学</h4><p>开发中请把其当做指明灯，来指引你做决策：</p><ul><li>DRY：「Don’t Repeat Yourself」不写<strong>重复</strong>的逻辑代码</li><li>约定俗成：优先选择框架提倡的做法，不过度配置</li><li>KISS：「Keep it Simple, Stupid」提倡简单易读的代码，不写高深、晦涩难懂的代码，<strong>不过度设计</strong></li><li>主厨精选： 让有经验的人来为你选择方案，不独创方案</li><li>官方提倡：优先选择官方推崇的方案</li></ul><h4 id="设计理念"><a href="#设计理念" class="headerlink" title="设计理念"></a>设计理念</h4><p>以下是一些优秀的『程序设计理念』：</p><ul><li>MVC ：Model，View，Controller，以MVC为核心，严格控制 Controller 的可读性和代码行数</li><li>Resutful：利用『资源化概念』和标准的 HTTP 动词来组织你的程序</li></ul><h4 id="开发和线上环境"><a href="#开发和线上环境" class="headerlink" title="开发和线上环境"></a>开发和线上环境</h4><p>一般情况下，一个项目 <strong>应该</strong> 有以下三个基本的项目环境：</p><ul><li>Local：开发环境</li><li>Staging：线上测试环境</li><li>Production：线上生产环境</li></ul><h4 id="开发专用扩展包"><a href="#开发专用扩展包" class="headerlink" title="开发专用扩展包"></a>开发专用扩展包</h4><p>我们都知道 Laravel 扩展包的注册会对应用造成消耗。</p><p>有一些扩展包是开发环境中专用，生产环境中并不会使用到。</p><p>为了避免无用的负载， 必须严格控制其安装和加载。</p><p>安装开发专用扩展包时 <strong>必须</strong> 使用 <code>--dev</code> 参数，如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require laracasts/generators --dev</span><br></pre></td></tr></table></figure><p>开发专用的 provider <strong>绝不</strong> 在 <code>config/app.php</code> 里面注册</p><p><strong>必须</strong> 在 <code>app/Providers/AppServiceProvider.php</code> 文件中使用如以下方式：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;app-&gt;environment() == <span class="string">'local'</span>) &#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;app-&gt;register(<span class="string">'Laracasts\Generators\GeneratorsServiceProvider'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="辅助函数"><a href="#辅助函数" class="headerlink" title="辅助函数"></a>辅助函数</h4><p>存放位置</p><p><strong>必须</strong> 把所有『自定义辅助函数』存放于 <code>bootstarp</code> 文件夹中。</p><p>并在 <code>bootstrap/app.php</code> 最顶部进行加载。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">'/helpers.php'</span>;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><h4 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h4><p>路由器要保证干净整洁， <strong>绝不</strong> 防止除路由配置以外的其他的程序逻辑。</p><p><strong>资源命名使用复数</strong>。</p><h5 id="Restful-路由"><a href="#Restful-路由" class="headerlink" title="Restful 路由"></a>Restful 路由</h5><p><strong>必须</strong> 优先使用 Restful 路由，配合资源控制器使用。</p><p>由资源控制器处理的行为：</p><table><thead><tr><th>动词</th><th>路径</th><th>行为（方法）</th><th>路由名称</th><th>注释</th></tr></thead><tbody><tr><td>GET</td><td><code>/photos</code></td><td>index</td><td>photos.index</td><td>首页</td></tr><tr><td>GET</td><td><code>/photos/create</code></td><td>create</td><td>photos.create</td><td>创建页面</td></tr><tr><td>POST</td><td><code>/photots</code></td><td>store</td><td>photos.store</td><td>数据入库</td></tr><tr><td>GET</td><td><code>/photos/{id}</code></td><td>show</td><td>photos.show</td><td>个人展示页</td></tr><tr><td>GET</td><td><code>/photos/{id}/edit</code></td><td>edit</td><td>photos.edit</td><td>个人编辑页</td></tr><tr><td>PUT / PATCH</td><td><code>/photos/{id}</code></td><td>update</td><td>photos.update</td><td>个人信息更新</td></tr><tr><td>DELETE</td><td><code>/photos/{id}</code></td><td>destory</td><td>photos.destory</td><td>个人信息删除</td></tr></tbody></table><h5 id="全局路由参数"><a href="#全局路由参数" class="headerlink" title="全局路由参数"></a>全局路由参数</h5><p>出于安全考虑， <strong>应该</strong> 使用全局路由器参数限制。</p><p><strong>必须</strong> 在 <code>RouteServiceProvider</code> 文件的 boot 方法里定义模式：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义你的路由模型绑定，模式过滤器等。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  \Illuminate\Routing\Router  $router</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">(Router $router)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 路由参数限制</span></span><br><span class="line">    $router-&gt;pattern(<span class="string">'id'</span>, <span class="string">'[0-9]+'</span>);</span><br><span class="line">    <span class="comment">// 模型绑定</span></span><br><span class="line">    Route::bind(<span class="string">'user_name'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($value)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> User::where(<span class="string">'name'</span>, $value)-&gt;first();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">parent</span>::boot($router);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>模式一旦被定义，遍会自动应用到所有使用该参数名称的路由上：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'users/&#123;id&#125;'</span>, <span class="string">'UsersController@show'</span>);</span><br><span class="line">Route::get(<span class="string">'photos/&#123;id&#125;'</span>, <span class="string">'PhotosController@show'</span>);</span><br></pre></td></tr></table></figure><p>只有 id 为数字时，才会路由到控制器方法中，否则 404 错误。</p><h5 id="获取-URL"><a href="#获取-URL" class="headerlink" title="获取 URL"></a>获取 URL</h5><p>获取 URL <strong>必须</strong> 遵循以下优先级：</p><ol><li><code>$model-&gt;link()</code></li><li><code>route</code> 方法</li><li><code>url</code> 方法</li></ol><p>在 Model 中创建 <code>link()</code> 方法：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">link</span><span class="params">($params = [])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $params = array_merge([<span class="keyword">$this</span>-&gt;id], $params);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> route(<span class="string">'models.show'</span>, $params);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>所有单个模型数据链接使用：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$model-&gt;link();</span><br><span class="line"><span class="comment">// 或者添加参数</span></span><br><span class="line">$model-&gt;link($params = [<span class="string">'source'</span> =&gt; <span class="string">'list'</span>])</span><br></pre></td></tr></table></figure><p>『单个模型 URI』经常会发生变化，这样做将会让程序更加灵活。</p><p>除了『单个模型 URI』，其他路由 <strong>必须</strong> 使用 <code>route</code> 来获取 URL：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$url = route(<span class="string">'profile'</span>, [<span class="string">'id'</span> =&gt; <span class="number">1</span>]);</span><br></pre></td></tr></table></figure><p>无法使用 <code>route</code> 的情况下， <strong>可以</strong> 使用 <code>url</code> 方法来获取 URL：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">'profile'</span>, [<span class="number">1</span>]);</span><br></pre></td></tr></table></figure><h4 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h4><p>模型命名使用 <strong>单数</strong> 。</p><h5 id="放置位置"><a href="#放置位置" class="headerlink" title="放置位置"></a>放置位置</h5><p>所有的数据模型文件，都 <strong>必须</strong> 存放在：<code>app/Models/</code> 文件夹中。</p><p>命名空间：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Models</span>;</span><br></pre></td></tr></table></figure><h5 id="User-php"><a href="#User-php" class="headerlink" title="User.php"></a>User.php</h5><p>Laravel 默认安装会把 <code>User</code> 模型存放在 <code>app/User.php</code> ， <strong>必须</strong> 移动到 <code>app/Models</code> 文件夹中，并修改命名空间为 <code>App/Models</code> 。</p><p>为了不破坏原来的逻辑点，必须全局搜索 <code>App/User</code> 并替换为 <code>App/Models/User</code> 。</p><h5 id="使用基类"><a href="#使用基类" class="headerlink" title="使用基类"></a>使用基类</h5><p>所有的 <strong>Eloquent 数据模型</strong> 都 <strong>必须</strong> 继承统一的基类 <code>App/Models/Model</code> ，此基类存放位置为 <code>/app/Models/Model.php</code>，内容参考以下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Models</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span> <span class="title">as</span> <span class="title">EloquentModel</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model</span> <span class="keyword">extends</span> <span class="title">EloquentModel</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">scopeRecent</span><span class="params">($query)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $query-&gt;orderBy(<span class="string">'created_at'</span>, <span class="string">'desc'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="命名规范"><a href="#命名规范" class="headerlink" title="命名规范"></a>命名规范</h5><p>数据模型相关命名规范：</p><ul><li>数据模型类名 <code>必须</code> 为「单数」, 如：<code>App\Models\Photo</code></li><li>类文件名 <code>必须</code> 为「单数」，如：<code>app/Models/Photo.php</code></li><li>数据库表名字 <code>必须</code> 为「复数」，多个单词情况下使用「<a href="https://en.wikipedia.org/wiki/Snake_case" target="_blank" rel="noopener">Snake Case</a>」 如：<code>photos</code>, <code>my_photos</code></li><li>数据库表迁移名字 <code>必须</code> 为「复数」，如：<code>2014_08_08_234417_create_photos_table.php</code></li><li>数据填充文件名 <code>必须</code> 为「复数」，如：<code>PhotosTableSeeder.php</code></li><li>数据库字段名 <code>必须</code> 为「<a href="https://en.wikipedia.org/wiki/Snake_case" target="_blank" rel="noopener">Snake Case</a>」，如：<code>view_count</code>, <code>is_vip</code></li><li>数据库表主键 <code>必须</code> 为「id」</li><li>数据库表外键 <code>必须</code> 为「resource_id」，如：<code>user_id</code>, <code>post_id</code></li><li>数据模型变量 <code>必须</code> 为「resource_id」，如：<code>$user_id</code>, <code>$post_id</code></li></ul><h4 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h4><p>控制器命名用 <strong>复数</strong>。</p><p><strong>必须</strong> 优先使用 Restful 资源控制器。</p><h5 id="保持短小精练"><a href="#保持短小精练" class="headerlink" title="保持短小精练"></a>保持短小精练</h5><p><strong>必须</strong> 保持控制器文件代码行数最小化，还有可读性。</p><ul><li><strong>不应该</strong> 为「方法」书写注释，这要求方法取名要足够合理，不需要过多注释；</li><li><strong>应该</strong> 为一些复杂的逻辑代码块书写注释，主要介绍产品逻辑 - <code>为什么要这么做。</code>；</li><li><strong>不应该</strong> 在控制器中书写「私有方法」，控制器里 <code>应该</code> 只存放「路由动作方法」；</li><li><strong>绝不</strong> 遗留「死方法」，就是没有用到的方法，控制器里的所有方法，都应该被使用到，否则应该删除；</li><li><strong>绝不</strong> 在控制器里批量注释掉代码，无用的逻辑代码就必须清除掉。</li></ul><h4 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h4><h5 id="优先使用-Blade"><a href="#优先使用-Blade" class="headerlink" title="优先使用 Blade"></a>优先使用 Blade</h5><p>视图文件 <strong>必须</strong> 优先考虑使用 <code>.blade.php</code> 后缀来指定使用 <code>Blade</code> 模板引擎。</p><h5 id="保持目录清晰"><a href="#保持目录清晰" class="headerlink" title="保持目录清晰"></a>保持目录清晰</h5><ul><li>layouts - 页面布局文件 <strong>必须</strong> 放置于此目录下；</li><li>common - 存放页面通用元素；</li><li>pages - 简单的页面存放文件夹，如：about、contact 等；</li><li>resources - 对应 Restful 路由的资源路径名称，以 URI <code>photos/create</code> 为例，对应 <code>create.blade.php</code>文件，存放在文件夹 <code>photos</code> 下。</li></ul><p><strong>必须</strong> 避免在 <code>resources/views</code> 目录下直接放置视图文件。</p><h5 id="局部视图"><a href="#局部视图" class="headerlink" title="局部视图"></a>局部视图</h5><p>局部视图文件 <strong>必须</strong> 使用 <code>_</code> 前缀来命名，如：<code>photos/_upload_form.blade.php</code> 。</p><h5 id="视图命名要释义"><a href="#视图命名要释义" class="headerlink" title="视图命名要释义"></a>视图命名要释义</h5><p>为了和 Restful 路由器和资源控制器保持一致，视图命名也 <strong>必须</strong> 使用资源视图的命名方式。以 <code>photos</code> 为例：</p><ul><li><code>photos/index.blade.php</code><ul><li>内容列表视图</li><li>对应路由器 <code>/photos</code>，命名 <code>photos.index</code></li><li>控制器方法 <code>PhotosController@index</code></li></ul></li></ul><h5 id="create-and-edit-视图"><a href="#create-and-edit-视图" class="headerlink" title="create_and_edit 视图"></a><code>create_and_edit</code> 视图</h5><p>很多情况下，创建和编辑视图里的页面结构接近相似，在这种情况下，<strong>应该</strong> 使用 <code>create_and_edit</code> 视图。以 <code>photos</code> 为例：</p><ul><li><code>PhotosController@create</code> - 对应视图：<code>/photos/create_and_edit.blade.php</code></li><li><code>PhotosController@edit</code> - 对应 视图：<code>/photos/create_and_edit.blade.php</code></li></ul><h4 id="表单验证"><a href="#表单验证" class="headerlink" title="表单验证"></a>表单验证</h4><p><strong>必须</strong> 使用 表单请求 - FormRequest 类来处理控制器里的表单验证。</p><p><strong>绝不</strong> 使用 <code>authorize()</code> 方法来做用户授权，用户授权我们会单独使用 <code>Policy</code> 授权策略 来实现。</p><h5 id="使用基类-1"><a href="#使用基类-1" class="headerlink" title="使用基类"></a>使用基类</h5><p>所有 FormRequest 表验证类 <strong>必须</strong> 继承 <code>app/Http/Requests/Request.php</code> 基类。</p><p>基类文件如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Http</span>\<span class="title">FormRequest</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span> <span class="keyword">extends</span> <span class="title">FormRequest</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">authorize</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// Using policy for Authorization</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="验证类命名"><a href="#验证类命名" class="headerlink" title="验证类命名"></a>验证类命名</h5><p>命名使用 <strong>单数</strong> 。</p><p>FormRquest 表验证类 <strong>必须</strong> 遵循 <strong>资源控制器</strong> 方式进行命名，<code>photos</code> 对应 <code>app/Http/Requests/PhotoRequest.php</code></p><h5 id="类文件参考"><a href="#类文件参考" class="headerlink" title="类文件参考"></a>类文件参考</h5><p>FormRequest 表验证文件参考以下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PhotoRequest</span> <span class="keyword">extends</span> <span class="title">Request</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rules</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(<span class="keyword">$this</span>-&gt;method())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// CREATE</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">'POST'</span>:</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> [</span><br><span class="line">                    <span class="comment">// CREATE ROLES</span></span><br><span class="line">                ];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// UPDATE</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">'PUT'</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'PATCH'</span>:</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> [</span><br><span class="line">                    <span class="comment">// UPDATE ROLES</span></span><br><span class="line">                ];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'GET'</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'DELETE'</span>:</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> [];</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">messages</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            <span class="comment">// Validation messages</span></span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="授权策略"><a href="#授权策略" class="headerlink" title="授权策略"></a>授权策略</h5><h5 id="使用基类-2"><a href="#使用基类-2" class="headerlink" title="使用基类"></a>使用基类</h5><p>所有 Policy 授权策略类 <strong>必须</strong> 继承 <code>app/Policies/Policy.php</code> 基类。</p><p>基类文件如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Policies</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Auth</span>\<span class="title">Access</span>\<span class="title">HandlesAuthorization</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Policy</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">HandlesAuthorization</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">before</span><span class="params">($user, $ability)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($user-&gt;isAdmin()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="授权策略命名"><a href="#授权策略命名" class="headerlink" title="授权策略命名"></a>授权策略命名</h5><p>命名使用 <strong>单数</strong> 。</p><p>Policy 授权策略类 <strong>必须</strong> 遵循 <strong>资源路由</strong> 方式进行命名，<code>photos</code> 对应 <code>/app/Policies/PhotoPolicy.php</code> 。</p><h5 id="类文件参考-1"><a href="#类文件参考-1" class="headerlink" title="类文件参考"></a>类文件参考</h5><p>Policy 授权策略文件内容参考以下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Policies</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Photo</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PhotoPolicy</span> <span class="keyword">extends</span> <span class="title">Policy</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">(User $user, Photo $photo)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $user-&gt;isAuthorOf($photo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">destroy</span><span class="params">(User $user, Photo $photo)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $user-&gt;isAuthorOf($photo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="自动判断授权策略"><a href="#自动判断授权策略" class="headerlink" title="自动判断授权策略"></a>自动判断授权策略</h5><p><strong>应该</strong> 使用 自动授权策略方法，这样控制器和授权类的方法名就统一起来了。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新指定的文章。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  int  $id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $post = Post::findOrFail($id);</span><br><span class="line">    <span class="comment">// 会自动调用 `PostPolicy` 类中的 `update` 方法。</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;authorize($post);</span><br><span class="line">    <span class="comment">// 更新文章...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Auth-中间件"><a href="#Auth-中间件" class="headerlink" title="Auth 中间件"></a>Auth 中间件</h4><p>Auth 中间件 <strong>必须</strong> 书写在控制器 <code>__construct</code> 方法中，并且 <strong>必须</strong> 使用 <code>except</code> 黑名单进行过滤。</p><p>这样当你新增控制器方法时，默认是安全的。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;middleware(<span class="string">'auth'</span>, [            </span><br><span class="line">        <span class="string">'except'</span> =&gt; [<span class="string">'show'</span>, <span class="string">'index'</span>]</span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="post-announce">感谢您的阅读，本文由 <a href="https://laravel-china.org/docs/laravel-specification/5.5/whats-the-use-of-standards/510">Summer</a> 原创提供。如若转载，请注明出处：Summer（<a href="https://laravel-china.org/docs/laravel-specification/5.5/whats-the-use-of-standards/510">https://laravel-china.org/docs/laravel-specification/5.5/whats-the-use-of-standards/510</a>）</div><div class="post__prevs"><div class="post__prev"><a href="/2018/08/22/yii2-learn-note/" title="初次接触 Yii"><i class="iconfont icon-prev"></i>初次接触 Yii</a></div><div class="post__prev post__prev--right"><a href="/2018/10/17/mac-ss-cmd/" title="Mac命令行终端下使用shadowsocks翻墙">Mac命令行终端下使用shadowsocks翻墙<i class="iconfont icon-next"></i></a></div></div></div></article><div id="comment-container"></div></div><aside class="page__sidebar"><form id="page-search-from" class="page__search-from" action="/search/"><label class="search-form__item"><input class="input" type="text" name="search" placeholder="Search..."> <i class="iconfont icon-search"></i></label></form><div class="sidebar__block"><h3 class="block__title">简介</h3><p class="block__text">总不能还没有努力就向生活妥协。</p></div><div class="sidebar__block"><h3 class="block__title">文章分类</h3><ul class="block-list"><li class="block-list-item"><a class="block-list-link" href="/categories/那些年踩过的坑/">那些年踩过的坑</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/运维笔记/">运维笔记</a><span class="block-list-count">2</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/后端开发/">后端开发</a><span class="block-list-count">5</span></li></ul></div><div class="sidebar__block"><h3 class="block__title">最新文章</h3><ul class="block-list latest-post-list"><li class="latest-post-item"><a href="/2018/10/17/mac-ss-cmd/" title="Mac命令行终端下使用shadowsocks翻墙"><div class="item__cover"><img src="/img/posts/mac.jpeg" alt="Mac命令行终端下使用shadowsocks翻墙"></div><div class="item__info"><h3 class="item__title">Mac命令行终端下使用shadowsocks翻墙</h3><span class="item__text">2018-10-17</span></div></a></li><li class="latest-post-item"><a href="/2018/09/25/laravel-specification/" title="Laravel 项目开发规范"><div class="item__cover"><img src="/img/posts/laravel.png" alt="Laravel 项目开发规范"></div><div class="item__info"><h3 class="item__title">Laravel 项目开发规范</h3><span class="item__text">2018-09-25</span></div></a></li><li class="latest-post-item"><a href="/2018/08/22/yii2-learn-note/" title="初次接触 Yii"><div class="item__cover"><img src="/img/posts/yii.png" alt="初次接触 Yii"></div><div class="item__info"><h3 class="item__title">初次接触 Yii</h3><span class="item__text">2018-08-22</span></div></a></li><li class="latest-post-item"><a href="/2018/08/16/php-psr/" title="PHP 标准规范"><div class="item__cover"><img src="/img/posts/psr.jpg" alt="PHP 标准规范"></div><div class="item__info"><h3 class="item__title">PHP 标准规范</h3><span class="item__text">2018-08-16</span></div></a></li></ul></div><div class="sidebar__block"><h3 class="block__title">文章标签</h3><ul class="block-list tag-list clearfix"><li class="tag-item"><a class="tag-link" href="/tags/laravel/">laravel</a></li><li class="tag-item"><a class="tag-link" href="/tags/linux/">linux</a></li><li class="tag-item"><a class="tag-link" href="/tags/mac/">mac</a></li><li class="tag-item"><a class="tag-link" href="/tags/php/">php</a></li><li class="tag-item"><a class="tag-link" href="/tags/yii2-0/">yii2.0</a></li><li class="tag-item"><a class="tag-link" href="/tags/人艰不拆/">人艰不拆</a></li></ul></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--4"><h3 class="item__title">关于</h3><div class="item__content"><p class="item__text">本站是基于 Hexo 搭建的静态资源博客，主要用于分享日常学习、生活及工作的一些心得总结，欢迎点击右下角订阅 rss。</p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span>Shantou, Guangdong Province, China</span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span>chenchao_cn@qq.com</span></li></ul></div></div><div class="footer-top__item"><h3 class="item__title">友情链接</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://github.com/Mrminfive/hexo-theme-skapp" title="hexo-theme-skapp" target="_blank">hexo-theme-skapp</a></li></ul></div></div><div class="footer-top__item"><h3 class="item__title">构建工具</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://hexo.io/" title="Blog Framework" target="_blank">Hexo</a></li></ul></div></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">© <a href="https://github.com/Mrminfive/hexo-theme-skapp" target="_blank">Skapp</a> 2017 powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, made by <a href="https://github.com/Mrminfive" target="_blank">minfive</a>.</p><ul class="footer__social-network clearfix"><li class="social-network__item"><a href="https://github.com/Double-C" target="_blank" title="github"><i class="iconfont icon-github"></i></a></li><li class="social-network__item"><a href="mailto:chenchao_cn@qq.com" target="_blank" title="email"><i class="iconfont icon-email"></i></a></li><li class="social-network__item"><a href="/atom.xml" target="_blank" title="rss"><i class="iconfont icon-rss"></i></a></li></ul></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/md5.min.js"></script><script>var tags=["php","laravel"],gitalk=new Gitalk({clientID:"0ab6fbc345e392e6cfb9",clientSecret:"a00e86d6d283eb80bfb5138b1a23e756654883b6",repo:"double-c.github.io",owner:"Double-C",admin:["Double-C"],labels:tags,id:new Date(1537837168e3).getTime()>new Date("2018-02-15").getTime()?md5(location.pathname):location.pathname});gitalk.render("comment-container")</script><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>