<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><title>设计模式的六大原则 | 而废不能半途</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="[object Object]"><meta name="designer" content="minfive"><meta name="keywords" content="double-c, chao, 后端, 程序员, laravel, php"><meta name="description" content="总不能还没有努力就向生活妥协。"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="https://double-c.github.io/2019/01/28/php-design-six-rule/index.html"><link rel="icon" type="image/png" href="/img/favicon.ico" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="Double-c"><link rel="stylesheet" href="/scss/views/page/post.css"></head><body ontouchstart><div id="page-loading" class="page page-loading" style="background-image:url(/img/loader.gif)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="Double-c" alt="Double-c"><img src="/img/chao-logo-white.png" alt="Double-c"></a><nav class="page__nav"><ul class="nav__list clearfix"><li class="nav__item"><a href="/" alt="首页" title="首页">首页</a></li><li class="nav__item"><a href="/archives" alt="归档" title="归档">归档</a></li><li class="nav__item"><a href="/about" alt="关于" title="关于">关于</a></li></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><div class="post__cover"><img src="/img/posts/code.jpg" alt="设计模式的六大原则"></div><header class="post__info"><h1 class="post__title">设计模式的六大原则</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="https://github.com/Double-C">chao</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2019-01-28</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/php/">Php</a></li></ul></div></div></header><div class="post__content"><h2 id="设计模式的六大原则"><a href="#设计模式的六大原则" class="headerlink" title="设计模式的六大原则"></a>设计模式的六大原则</h2><h4 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h4><ul><li><a href="#单一职责原则">单一职责原则</a></li><li><a href="#里氏替换原则">里氏替换原则</a></li><li><a href="#依赖倒置原则">依赖倒置原则</a></li><li><a href="#接口隔离原则">接口隔离原则</a></li><li><a href="#迪米特法则">迪米特法则</a></li><li><a href="#开闭原则">开闭原则</a></li></ul><h4 id="单一职责原则"><a href="#单一职责原则" class="headerlink" title="单一职责原则"></a>单一职责原则</h4><p><strong>引言：</strong></p><p>​ 说到单一职责原则很多都会不屑一顾，因为它 <strong>太简单</strong> 了，稍微有经验的程序员即使没有读过设计模式，没有听说过单一职责原则，在设计软件时也会自觉遵守这一重要原则。因为这是常识。</p><p>​ 在软件编程中，谁也不希望因为修改了一个功能导致其它功能发生故障。虽然单一原则如此简单，并被认定为常识，但是即便是经验丰富的程序员写出的程序，也会有违背这一原则的代码存在。</p><p>​ 为什么会出现这种现象？</p><p>​ 因为有职责扩散。所谓职责扩散，就是因为某种原因，职责P被分化为粒度更细的职责P1和职责P2。</p><p>​ 比如：类T只负责职责P，这样设计是符合单一职责原则的。后来由于某种原因，也许是需求变更了，也许是程序的设计者境界提高了，需要将职责P细分为粒度更细的P1和P2，这时如果要使程序遵循单一职责原则，需要将类T也分解为T1和T2，分别负责P1和P2两个职责。但在程序已经写好的情况下，这样做简直太浪费时间了。所以简单的修改类T，用它来负责两个职责是一个比较不错的选择。虽然这样做有悖于单一职责原则。</p><blockquote><p>这样做的风险在于 <strong>职责扩展的不稳定性</strong> ，因为我们不会想到这个职责P，在未来可能会扩散为P1，P2，P3，P4 …… Pn 。</p><p>所以记住，在职责扩散到我们无法控制的程度之前，立刻对代码进行重构。</p></blockquote><p><strong>定义：</strong></p><p>一个类只负责一项职责，不要存在多于一个导致类变更的原因。</p><p><strong>实例：</strong></p><ul><li>需求：用一个类描述动物呼吸这个场景</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">breathe</span><span class="params">(string $animal)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&#123;$animal&#125;呼吸空气"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br /&gt;"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$animal = <span class="keyword">new</span> Animal();</span><br><span class="line">$animal-&gt;breathe(<span class="string">'牛'</span>);</span><br><span class="line">$animal-&gt;breathe(<span class="string">'羊'</span>);</span><br><span class="line">$animal-&gt;breathe(<span class="string">'猪'</span>);</span><br></pre></td></tr></table></figure><ul><li>运行结果：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">牛呼吸空气</span><br><span class="line"></span><br><span class="line">羊呼吸空气</span><br><span class="line"></span><br><span class="line">猪呼吸空气</span><br></pre></td></tr></table></figure><p>程序上线之后，发现问题了，并不是所有动物都是呼吸空气的，例如：鱼是呼吸水的。</p><p>针对需求变更，有三种解决方法</p><ol><li><p>遵循单一职责原则，需要将类 <code>Animal</code> 细分为陆生动物类 <code>Terrestrial</code> 和水生动物类 <code>Aquatic</code></p></li><li><p>方法层面的单一职责原则，在类 <code>Animal</code> 中新增一个方法 <code>breatheTwo</code> 用于水生动物的呼吸。</p></li><li><p>代码层面的，直接修改 <code>breathe</code> 方法，判断变量 <code>$animal</code> 是什么种类的动物，执行对应的逻辑。</p></li></ol><ul><li>方法一：遵循单一职责原则（推荐做法）</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Terrestrial</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">breathe</span><span class="params">(string $animal)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&#123;$animal&#125;呼吸空气"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br /&gt;"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Aquatic</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">breathe</span><span class="params">(string $animal)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&#123;$animal&#125;呼吸水"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br /&gt;"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$terrestrial = <span class="keyword">new</span> Terrestrial();</span><br><span class="line">$terrestrial-&gt;breathe(<span class="string">'牛'</span>);</span><br><span class="line">$terrestrial-&gt;breathe(<span class="string">'羊'</span>);</span><br><span class="line">$terrestrial-&gt;breathe(<span class="string">'猪'</span>);</span><br><span class="line"></span><br><span class="line">$aquatic = <span class="keyword">new</span> Aquatic();</span><br><span class="line">$aquatic-&gt;breathe(<span class="string">'鱼'</span>);</span><br></pre></td></tr></table></figure><p>方法一 修改花销最大，不仅要修改类，还需要修改客户端。</p><ul><li>方法二：方法层面的单一职责原则</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">breathe</span><span class="params">(string $animal)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&#123;$animal&#125;呼吸空气"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br /&gt;"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">breatheTwo</span><span class="params">(string $animal)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&#123;$animal&#125;呼吸水"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br /&gt;"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$animal = <span class="keyword">new</span> Animal();</span><br><span class="line"></span><br><span class="line">$animal-&gt;breathe(<span class="string">'牛'</span>);</span><br><span class="line">$animal-&gt;breathe(<span class="string">'羊'</span>);</span><br><span class="line">$animal-&gt;breathe(<span class="string">'猪'</span>);</span><br><span class="line">$animal-&gt;breatheTwo(<span class="string">'鱼'</span>);</span><br></pre></td></tr></table></figure><p>方法二这种修改方式没有改动原来的方法<br>而是在类中直接新增了一个方法<br>这样虽然也违背了单一职责原则<br>但是在方法级别上却是符合单一职责原则的</p><ul><li>方法三：代码级别的修改</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">breathe</span><span class="params">(string $animal)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> ($animal == <span class="string">'鱼'</span>) &#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&#123;$animal&#125;呼吸水"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br /&gt;"</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&#123;$animal&#125;呼吸空气"</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br /&gt;"</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$animal = <span class="keyword">new</span> Animal();</span><br><span class="line"></span><br><span class="line">$animal-&gt;breathe(<span class="string">'牛'</span>);</span><br><span class="line">$animal-&gt;breathe(<span class="string">'羊'</span>);</span><br><span class="line">$animal-&gt;breathe(<span class="string">'猪'</span>);</span><br><span class="line">$animal-&gt;breathe(<span class="string">'鱼'</span>);</span><br></pre></td></tr></table></figure><p>方法三修改起来最简单，隐患却是最大的。<br>有一天需要把鱼分为呼吸淡水的鱼和呼吸海水的鱼<br>则又需要修改Animal类的breathe方法<br>而对原有方法的修改会对调用“猪”“牛””羊”等相关功能带来风险<br>也许你某一天会发现程序运行就结果变为 “牛呼吸水了”</p><p><strong>遵循单一职责原则的优点有：</strong></p><ul><li>可以降低类的复杂度，一个类只负责一项职责，其逻辑肯定要比负责多项职责简单得多</li><li>提高类的可读性，提高系统可维护性</li><li>变更引起的风险最低，当修改一个功能时，可以显著降低对其他功能的影响。</li></ul><blockquote><p>需要说明一点的是，单一职责原则不只是面向对象编程思想所持有的，只要模块化的程序设计，都适用单一职责原则。</p></blockquote><h4 id="里氏替换原则"><a href="#里氏替换原则" class="headerlink" title="里氏替换原则"></a>里氏替换原则</h4><p><strong>引言：</strong></p><p>​ 继承作为面向对象三大特性之一，在给程序设计带来巨大的便利的同时，也带来了弊端。</p><p>​ 比如使用继承会给程序带来入侵性，程序的可移植性降低，增加了对象的耦合性，如果一个类被其他类所继承，则当这个类需要修改时，必须考虑到所有的子类，而且父类修改后，所有涉及到子类的功能都有可能会产生故障。</p><p>​ 继承包含这样一层含义：父类中凡是实现好的方法（相对于抽象方法而言），实际上是在设定一定系列的规范和契约，虽然它不强制要求所有子类必须遵从这些契约，但是如果子类对这些非抽象方法任意修改，就会对整个抽象体系造成破坏。而历史替换原则就是表达了这一层含义。</p><p><strong>定义：</strong></p><p>子类可以扩展父类的功能，但不能改变父类原有的功能。</p><ul><li>子类可以实现父类的抽象方法，但不能覆盖父类的非抽象方法</li><li>子类可以增加自己特有的方法</li><li>当子类的方法重载父类的方法时，方法的前置条件（即方法的形参）要比父类的输入参数更宽松</li><li>当子类的方法实现父类的抽象方法时，方法的后置条件（即方法的返回值）要比父类更严格</li></ul><h4 id="依赖倒置原则"><a href="#依赖倒置原则" class="headerlink" title="依赖倒置原则"></a>依赖倒置原则</h4><p><strong>引言：</strong></p><p>​ 依赖倒置原则基于这样一个事实：相对于细节的多变性，抽象的东西要稳定的多。以抽象为基础搭建起来的架构比以细节搭建起来的架构要稳定的多。</p><p>​ 抽象指的是接口或者抽象类；细节就是具体的实现类，使用接口或者抽象类的目的是制定好规范和契约，而不去涉及任何具体的操作，把展现的细节的任务交给他们的实现类去完成。</p><p>​ 依赖倒置原则的核心思想是 <strong>面向接口编程</strong> 。</p><p><strong>定义：</strong></p><p>高层模块不应该依赖低层模块，二者都应该依赖其抽象；抽象不依赖细节；细节应该依赖抽象。</p><p><strong>实例：</strong></p><ul><li>需求：母亲给孩子讲故事，只要给她一本书，她就可以照着书给孩子讲故事了。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getContent</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"很久很久以前有一个阿拉伯的故事......"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mother</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">narrate</span><span class="params">(Book $book)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'妈妈开始讲故事：'</span> . $book-&gt;getContent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$mother = <span class="keyword">new</span> Mother();</span><br><span class="line">$book = <span class="keyword">new</span> Book();</span><br><span class="line">$mother-&gt;narrate($book);</span><br></pre></td></tr></table></figure><ul><li>运行结果：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">妈妈开始讲故事：很久很久以前有一个阿拉伯的故事......</span><br></pre></td></tr></table></figure><p>假如有一天，需求变成这样：不是给书而是给一份报纸，让这位母亲讲一下报纸上的故事，报纸代码如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Newspaper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getContent</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"林书豪38+7领导尼克斯击败湖人"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这位母亲居然办不到，因为她居然不会读报纸上的故事，这太荒唐了，只是将书换成报纸，居然必须要修改 <code>Mother</code> 类才能读。</p><p>假如以后需求换成杂志呢？换成网页呢？还要不断修改 <code>Mother</code> 类，这显然不是好的设计。原因是 <code>Mother</code> 和 <code>Book</code> 之间的耦合性太高了，必须降低他们之间的耦合度才行。</p><ul><li>解决方法：我们引入一个抽象的接口 <code>IReader</code> 。读物，只要是带字的都属于读物，每种读物都有自己的名称。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IReader</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getContent</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span> <span class="keyword">implements</span> <span class="title">IReader</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getContent</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"很久很久以前有一个阿拉伯的故事......"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getName</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    	<span class="keyword">return</span> <span class="string">"故事"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Newspaper</span> <span class="keyword">implements</span> <span class="title">IReader</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getContent</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"林书豪38+7领导尼克斯击败湖人"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getName</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    	<span class="keyword">return</span> <span class="string">"报纸"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mother</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">narrate</span><span class="params">(IReader $iReader)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'妈妈开始讲'</span> . $iReader-&gt;getName() . <span class="string">'：'</span> . $iReader-&gt;getContent();</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;hr&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$mother = <span class="keyword">new</span> Mother();</span><br><span class="line">$book = <span class="keyword">new</span> Book();</span><br><span class="line">$newspaper = <span class="keyword">new</span> Newspaper();</span><br><span class="line">$mother-&gt;narrate($book);	<span class="comment">// 故事书</span></span><br><span class="line">$mother-&gt;narrate($newspaper);	<span class="comment">// 报纸</span></span><br></pre></td></tr></table></figure><ul><li>运行结果：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">妈妈开始讲故事：很久很久以前有一个阿拉伯的故事......</span><br><span class="line">妈妈开始讲报纸：林书豪38+7领导尼克斯击败湖人</span><br></pre></td></tr></table></figure><p>这样修改后，以后无论怎么扩展客户端，都不需要修改 <code>Mother</code> 类。这只是一个简单的例子。</p><p>代表高层模块的 <code>Mother</code> 类负责完成主要的业务逻辑，一旦需要对它进行修改，引入的风险极大。所以遵循依赖倒置原则可以降低类之间的耦合性，提高系统的稳定性，降低修改程序造成的风险。</p><p>采用依赖倒置原则给多人并行开发带来了极大的便利，比如上例中，原本 <code>Mother</code> 类于 <code>Book</code> 类直接耦合时，<code>Mother</code> 类依赖于 <code>Book</code> 类。修改后的程序则可以同时开工，互不影响，因为 <code>Mother</code> 于 <code>Book</code> 类一点关系也没有。参与开发的人越多、项目越庞大，采用依赖倒置原则的意义就越重大。现在很流行的 TDD 开发模式就是依赖倒置原则最成功的应用。</p><p>传递依赖关系有三种方式，以上例子中使用的方法是接口传递，另外还有两种传递方式：构造方法传递和 <code>setter</code> 方法传递。</p><p>在实际编程中，我们一般需要做到如下3点：</p><ul><li>低层模块尽量要有抽象类或者接口，或者两者都有</li><li>变量的声明类型尽量是抽象类或接口</li><li>使用继承时遵循 <strong>里氏替换原则</strong></li></ul><p><strong>依赖倒置原则的核心就是要我们面向接口编程，理解了面向接口编程，也就理解了依赖倒置。</strong></p><h4 id="接口隔离原则"><a href="#接口隔离原则" class="headerlink" title="接口隔离原则"></a>接口隔离原则</h4><p><strong>引言：</strong></p><p>​ 很多人会觉得接口隔离原则和之前的单一职责原则很相似，其实不然。其一，单一职责原则注重的是职责；而接口隔离注重对接口依赖的隔离。其二，单一职责主要是约束类，其次才是接口和方法，它针对的是程序中的实现和细节；而接口隔离主要约束接口，主要针对抽象，针对程序整体框架的构建。</p><p><strong>定义：</strong></p><p>​ 建立单一接口，不要建立庞大臃肿的接口，尽量细化接口，接口中的方法尽可能少。</p><p>​ 我们要每个类建立专用的接口，而不要试图去建立一个很庞大的接口供所有依赖它的类去调用。</p><h4 id="迪米特法则"><a href="#迪米特法则" class="headerlink" title="迪米特法则"></a>迪米特法则</h4><p><strong>引言：</strong></p><p>​ 自从我们接触编程开始，就知道了软件编程总的原则：低耦合，高内聚。无论是面向过程编程还是面向对象编程，只有使各个模块之间的耦合尽量的低，才能提高代码的复用率。</p><p>​ 迪米特法则的初衷是降低类之间的耦合，由于每个类都减少了不必要的依赖，因此的确可以降低耦合关系。但凡事有有度，虽然可以避免与非直接的类通信，但是要通信，必然会通过一个『 中介 』，过分的使用迪米特法则，会产生大量的中介和传递类，导致系统复杂度变大。</p><p><strong>定义：</strong></p><p>​ 一个类对自己依赖的类知道的越少越好。也就是说，对于被依赖的类来说，无论逻辑多么复杂，都尽量地的将逻辑封装在类的内部，对外提供 <code>public</code> 方法，不对外泄露任何信息。</p><h4 id="开闭原则"><a href="#开闭原则" class="headerlink" title="开闭原则"></a>开闭原则</h4><p><strong>引言：</strong></p><p>​ 在软件的生命周期内，因为变化、升级和维护等原因需要对软件原有代码进行修改时，可能会给旧代码引入错误，也可能会使我们不得不对整个功能进行重构，并且需要原有代码经过重新测试。</p><p>​ 开闭原则是面向对象设计中最基础的设计原则，它指导我们如何建立稳定灵活的系统。用抽象构建框架，用实现扩展细节。因为抽象灵活性好，适应性广，只要抽象的合理，可以基本保持软件架构的稳定。而软件中易变的细节，我们从抽象派生的实现类来进行扩展，当软件需要发生变化时，我们只需要根据需求重新派生一个实现类来进行扩展。<strong>当然前提是我们的抽象要合理，要对需求的变更有前瞻性和预见性才行。</strong></p><p><strong>定义：</strong></p><p>​ 一个软件实体如类、模块和函数应该对扩展开放，对修改关闭。</p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>​ 开闭原则无非就是表达了这样一层意思：<strong>用抽象构建框架，用实现扩展细节</strong>。</p><p>​ 因为抽象灵活性好，适应性广，只要抽象的合理，可以基本保持软件架构的稳定。</p><p>​ 而软件中易变的细节，我们用从抽象派生的实现类来进行扩展，当软件需要变化时。我们只需要根据需求重新派生一个实现类扩展就可以了。</p><p>​ 当然前提是我们的抽象要合理，<strong>要对需求的变更有前瞻性和预见性才行</strong>。</p><p>​ 回想前面说的几项原则，恰恰是告诉我们用抽象构建框架，用实现扩展细节的注意事项而已：单一职责原则告诉我们类要职责单一；里氏替换原则告诉我们不要破坏继承体系；依赖倒置原则告诉我们要面向接口编程；接口隔离原则告诉我们在设计接口的时候要精简单一；迪米特法则告诉我们要降低耦合；而开闭原则是总纲，他告诉我们要对扩展开放，对修改关闭。</p><blockquote><p>关键词 ： 抽象 - 接口 - 面向接口编程 - 封闭 - 不允许修改； 修改 - 接口派生的实现类 - 扩展 - 根据需求随时可可变；</p></blockquote><div class="post-announce">感谢您的阅读，本文由 <a href="https://double-c.github.io">Double-c</a> 版权所有。如若转载，请注明出处：Double-c（<a href="https://double-c.github.io/2019/01/28/php-design-six-rule/">https://double-c.github.io/2019/01/28/php-design-six-rule/</a>）</div><div class="post__prevs"><div class="post__prev"><a href="/2018/12/10/good/" title="你是怎么变自律？"><i class="iconfont icon-prev"></i>你是怎么变自律？</a></div><div class="post__prev post__prev--right"></div></div></div></article><div id="comment-container"></div></div><aside class="page__sidebar"><form id="page-search-from" class="page__search-from" action="/search/"><label class="search-form__item"><input class="input" type="text" name="search" placeholder="Search..."> <i class="iconfont icon-search"></i></label></form><div class="sidebar__block"><h3 class="block__title">简介</h3><p class="block__text">总不能还没有努力就向生活妥协。</p></div><div class="sidebar__block"><h3 class="block__title">文章分类</h3><ul class="block-list"><li class="block-list-item"><a class="block-list-link" href="/categories/那些年踩过的坑/">那些年踩过的坑</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/运维笔记/">运维笔记</a><span class="block-list-count">2</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/更好的自己/">更好的自己</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/后端开发/">后端开发</a><span class="block-list-count">9</span></li></ul></div><div class="sidebar__block"><h3 class="block__title">最新文章</h3><ul class="block-list latest-post-list"><li class="latest-post-item"><a href="/2019/01/28/php-design-six-rule/" title="设计模式的六大原则"><div class="item__cover"><img src="/img/posts/code.jpg" alt="设计模式的六大原则"></div><div class="item__info"><h3 class="item__title">设计模式的六大原则</h3><span class="item__text">2019-01-28</span></div></a></li><li class="latest-post-item"><a href="/2018/12/10/good/" title="你是怎么变自律？"><div class="item__cover"><img src="/img/posts/good.png" alt="你是怎么变自律？"></div><div class="item__info"><h3 class="item__title">你是怎么变自律？</h3><span class="item__text">2018-12-10</span></div></a></li><li class="latest-post-item"><a href="/2018/11/26/api-doc/" title="ApiDoc接口文档工具"><div class="item__cover"><img src="/img/posts/apidoc.jpg" alt="ApiDoc接口文档工具"></div><div class="item__info"><h3 class="item__title">ApiDoc接口文档工具</h3><span class="item__text">2018-11-26</span></div></a></li><li class="latest-post-item"><a href="/2018/11/17/git-many-accounts/" title="Git 配置多用户"><div class="item__cover"><img src="/img/posts/git.png" alt="Git 配置多用户"></div><div class="item__info"><h3 class="item__title">Git 配置多用户</h3><span class="item__text">2018-11-17</span></div></a></li></ul></div><div class="sidebar__block"><h3 class="block__title">文章标签</h3><ul class="block-list tag-list clearfix"><li class="tag-item"><a class="tag-link" href="/tags/api/">api</a></li><li class="tag-item"><a class="tag-link" href="/tags/git/">git</a></li><li class="tag-item"><a class="tag-link" href="/tags/laravel/">laravel</a></li><li class="tag-item"><a class="tag-link" href="/tags/linux/">linux</a></li><li class="tag-item"><a class="tag-link" href="/tags/mac/">mac</a></li><li class="tag-item"><a class="tag-link" href="/tags/php/">php</a></li><li class="tag-item"><a class="tag-link" href="/tags/yii2-0/">yii2.0</a></li><li class="tag-item"><a class="tag-link" href="/tags/人艰不拆/">人艰不拆</a></li><li class="tag-item"><a class="tag-link" href="/tags/自律/">自律</a></li></ul></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--4"><h3 class="item__title">关于</h3><div class="item__content"><p class="item__text">本站是基于 Hexo 搭建的静态资源博客，主要用于分享日常学习、生活及工作的一些心得总结，欢迎点击右下角订阅 rss。</p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span>Shantou, Guangdong Province, China</span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span>chenchao_cn@qq.com</span></li></ul></div></div><div class="footer-top__item"><h3 class="item__title">友情链接</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://github.com/Mrminfive/hexo-theme-skapp" title="hexo-theme-skapp" target="_blank">hexo-theme-skapp</a></li></ul></div></div><div class="footer-top__item"><h3 class="item__title">构建工具</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://hexo.io/" title="Blog Framework" target="_blank">Hexo</a></li></ul></div></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">© <a href="https://github.com/Mrminfive/hexo-theme-skapp" target="_blank">Skapp</a> 2017 powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, made by <a href="https://github.com/Mrminfive" target="_blank">minfive</a>.</p><ul class="footer__social-network clearfix"><li class="social-network__item"><a href="https://github.com/Double-C" target="_blank" title="github"><i class="iconfont icon-github"></i></a></li><li class="social-network__item"><a href="mailto:chenchao_cn@qq.com" target="_blank" title="email"><i class="iconfont icon-email"></i></a></li><li class="social-network__item"><a href="/atom.xml" target="_blank" title="rss"><i class="iconfont icon-rss"></i></a></li></ul></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/md5.min.js"></script><script>var tags=["php"],gitalk=new Gitalk({clientID:"0ab6fbc345e392e6cfb9",clientSecret:"a00e86d6d283eb80bfb5138b1a23e756654883b6",repo:"double-c.github.io",owner:"Double-C",admin:["Double-C"],labels:tags,id:new Date(1548647368e3).getTime()>new Date("2018-02-15").getTime()?md5(location.pathname):location.pathname});gitalk.render("comment-container")</script><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>